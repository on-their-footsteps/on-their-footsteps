import React, { useState, useEffect } from 'react'\nimport { motion } from 'framer-motion'\nimport { Play, Pause, CheckCircle, Clock, AlertCircle, Upload, FileText, Image, Mic, Video, Globe, TrendingUp, Users, Calendar, DollarSign, BarChart3 } from 'lucide-react'\n\nconst ContentProductionDashboard = ({ user }) => {\n  const [productions, setProductions] = useState([])\n  const [selectedProduction, setSelectedProduction] = useState(null)\n  const [pipelineStatus, setPipelineStatus] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [activeView, setActiveView] = useState('overview')\n  \n  const pipelineStages = [\n    { id: 'idea', name: 'Idea', icon: FileText, color: 'gray' },\n    { id: 'scripting', name: 'Scripting', icon: FileText, color: 'blue' },\n    { id: 'drawing', name: 'Drawing', icon: Image, color: 'purple' },\n    { id: 'voice_recording', name: 'Voice Recording', icon: Mic, color: 'green' },\n    { id: 'animation', name: 'Animation', icon: Video, color: 'orange' },\n    { id: 'final_review', name: 'Final Review', icon: CheckCircle, color: 'yellow' },\n    { id: 'published', name: 'Published', icon: Globe, color: 'green' }\n  ]\n  \n  useEffect(() => {\n    fetchProductions()\n  }, [])\n  \n  const fetchProductions = async () => {\n    try {\n      const token = localStorage.getItem('access_token')\n      const response = await fetch('http://localhost:8000/api/content_pipeline/productions', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setProductions(data)\n      }\n    } catch (error) {\n      console.error('Failed to fetch productions:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n  \n  const fetchPipelineStatus = async (productionId) => {\n    try {\n      const token = localStorage.getItem('access_token')\n      const response = await fetch(`http://localhost:8000/api/content_pipeline/productions/${productionId}/pipeline`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setPipelineStatus(data)\n      }\n    } catch (error) {\n      console.error('Failed to fetch pipeline status:', error)\n    }\n  }\n  \n  const handleProductionSelect = (production) => {\n    setSelectedProduction(production)\n    fetchPipelineStatus(production.id)\n    setActiveView('pipeline')\n  }\n  \n  const getStageStatus = (stage, pipelineData) => {\n    if (!pipelineData || !pipelineData.pipeline) return 'not_started'\n    \n    const stageData = pipelineData.pipeline[stage.replace('_', '')]\n    if (!stageData) return 'not_started'\n    \n    if (stage === 'script') {\n      return stageData.status === 'completed' ? 'completed' : \n             stageData.status === 'not_started' ? 'not_started' : 'in_progress'\n    }\n    \n    if (stageData.completed_count > 0 && stageData.completed_count === stageData.count) {\n      return 'completed'\n    } else if (stageData.completed_count > 0) {\n      return 'in_progress'\n    }\n    return 'not_started'\n  }\n  \n  const getStageColor = (status) => {\n    switch (status) {\n      case 'completed': return 'bg-green-500'\n      case 'in_progress': return 'bg-blue-500'\n      case 'not_started': return 'bg-gray-300'\n      default: return 'bg-gray-300'\n    }\n  }\n  \n  const renderOverview = () => (\n    <div className=\"space-y-6\">\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Productions</p>\n              <p className=\"text-2xl font-bold text-gray-900\">{productions.length}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-lg\">\n              <Video className=\"text-blue-600\" size={24} />\n            </div>\n          </div>\n        </motion.div>\n        \n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">In Production</p>\n              <p className=\"text-2xl font-bold text-gray-900\">\n                {productions.filter(p => p.overall_status === 'in_production').length}\n              </p>\n            </div>\n            <div className=\"p-3 bg-yellow-100 rounded-lg\">\n              <Clock className=\"text-yellow-600\" size={24} />\n            </div>\n          </div>\n        </motion.div>\n        \n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Published</p>\n              <p className=\"text-2xl font-bold text-gray-900\">\n                {productions.filter(p => p.overall_status === 'published').length}\n              </p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-lg\">\n              <CheckCircle className=\"text-green-600\" size={24} />\n            </div>\n          </div>\n        </motion.div>\n        \n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Avg Completion</p>\n              <p className=\"text-2xl font-bold text-gray-900\">\n                {productions.length > 0 \n                  ? Math.round(productions.reduce((sum, p) => sum + p.completion_percentage, 0) / productions.length)\n                  : 0}%\n              </p>\n            </div>\n            <div className=\"p-3 bg-purple-100 rounded-lg\">\n              <BarChart3 className=\"text-purple-600\" size={24} />\n            </div>\n          </div>\n        </motion.div>\n      </div>\n      \n      {/* Productions List */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.4 }}\n        className=\"bg-white rounded-xl shadow-lg border border-gray-200\"\n      >\n        <div className=\"p-6 border-b border-gray-200\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">Content Productions</h3>\n        </div>\n        <div className=\"divide-y divide-gray-200\">\n          {productions.map((production, index) => (\n            <motion.div\n              key={production.id}\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: index * 0.1 }}\n              className=\"p-6 hover:bg-gray-50 transition-colors cursor-pointer\"\n              onClick={() => handleProductionSelect(production)}\n            >\n              <div className=\"flex items-center justify-between mb-4\">\n                <div>\n                  <h4 className=\"font-semibold text-gray-900\">{production.title}</h4>\n                  <p className=\"text-sm text-gray-600\">{production.description}</p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${\n                    production.overall_status === 'published' ? 'bg-green-100 text-green-800' :\n                    production.overall_status === 'in_production' ? 'bg-blue-100 text-blue-800' :\n                    'bg-gray-100 text-gray-800'\n                  }`}>\n                    {production.overall_status}\n                  </span>\n                  <span className=\"text-sm text-gray-600\">\n                    {Math.round(production.completion_percentage)}% complete\n                  </span>\n                </div>\n              </div>\n              \n              {/* Progress Bar */}\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                  style={{ width: `${production.completion_percentage}%` }}\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between mt-4 text-sm text-gray-600\">\n                <span>Stage: {production.current_stage}</span>\n                <span>Manager: {production.project_manager}</span>\n                <span>Started: {new Date(production.start_date).toLocaleDateString()}</span>\n              </div>\n            </motion.div>\n          ))}\n        </div>\n      </motion.div>\n    </div>\n  )\n  \n  const renderPipeline = () => {\n    if (!selectedProduction || !pipelineStatus) {\n      return (\n        <div className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\">\n          <div className=\"text-center text-gray-500\">\n            Select a production to view pipeline status\n          </div>\n        </div>\n      )\n    }\n    \n    return (\n      <div className=\"space-y-6\">\n        {/* Production Header */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h2 className=\"text-2xl font-bold text-gray-900\">{selectedProduction.title}</h2>\n              <p className=\"text-gray-600\">{selectedProduction.description}</p>\n            </div>\n            <div className=\"text-right\">\n              <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                selectedProduction.overall_status === 'published' ? 'bg-green-100 text-green-800' :\n                selectedProduction.overall_status === 'in_production' ? 'bg-blue-100 text-blue-800' :\n                'bg-gray-100 text-gray-800'\n              }`}>\n                {selectedProduction.overall_status}\n              </span>\n              <div className=\"mt-2 text-sm text-gray-600\">\n                {Math.round(selectedProduction.completion_percentage)}% Complete\n              </div>\n            </div>\n          </div>\n          \n          {/* Overall Progress */}\n          <div className=\"w-full bg-gray-200 rounded-full h-3\">\n            <div \n              className=\"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500\"\n              style={{ width: `${selectedProduction.completion_percentage}%` }}\n            />\n          </div>\n        </motion.div>\n        \n        {/* Pipeline Stages */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">Production Pipeline</h3>\n          \n          <div className=\"space-y-6\">\n            {pipelineStages.map((stage, index) => {\n              const status = getStageStatus(stage.id, pipelineStatus)\n              const isCompleted = status === 'completed'\n              const isCurrent = selectedProduction.current_stage === stage.id\n              \n              return (\n                <div key={stage.id} className=\"flex items-center gap-4\">\n                  <div className=\"flex-shrink-0\">\n                    <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n                      getStageColor(status)\n                    }`}>\n                      <stage.icon size={20} className=\"text-white\" />\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <h4 className=\"font-semibold text-gray-900\">{stage.name}</h4>\n                      <span className={`text-sm px-2 py-1 rounded-full ${\n                        isCompleted ? 'bg-green-100 text-green-800' :\n                        isCurrent ? 'bg-blue-100 text-blue-800' :\n                        'bg-gray-100 text-gray-800'\n                      }`}>\n                        {status.replace('_', ' ')}\n                      </span>\n                    </div>\n                    \n                    {/* Stage-specific details */}\n                    {stage.id === 'script' && pipelineStatus.pipeline.script && (\n                      <div className=\"text-sm text-gray-600\">\n                        <p>Writer: {pipelineStatus.pipeline.script.writer || 'Not assigned'}</p>\n                        {pipelineStatus.pipeline.script.completed_at && (\n                          <p>Completed: {new Date(pipelineStatus.pipeline.script.completed_at).toLocaleDateString()}</p>\n                        )}\n                      </div>\n                    )}\n                    \n                    {stage.id === 'drawing' && pipelineStatus.pipeline.illustration && (\n                      <div className=\"text-sm text-gray-600\">\n                        <p>Progress: {pipelineStatus.pipeline.illustration.completed_count}/{pipelineStatus.pipeline.illustration.count} illustrations</p>\n                      </div>\n                    )}\n                    \n                    {stage.id === 'voice_recording' && pipelineStatus.pipeline.voice && (\n                      <div className=\"text-sm text-gray-600\">\n                        <p>Progress: {pipelineStatus.pipeline.voice.completed_count}/{pipelineStatus.pipeline.voice.count} recordings</p>\n                      </div>\n                    )}\n                    \n                    {stage.id === 'animation' && pipelineStatus.pipeline.animation && (\n                      <div className=\"text-sm text-gray-600\">\n                        <p>Progress: {pipelineStatus.pipeline.animation.completed_count}/{pipelineStatus.pipeline.animation.count} animations</p>\n                      </div>\n                    )}\n                  </div>\n                  \n                  {/* Stage Progress Bar */}\n                  <div className=\"w-32\">\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                      <div \n                        className={`h-2 rounded-full transition-all duration-300 ${\n                          isCompleted ? 'bg-green-500' :\n                          isCurrent ? 'bg-blue-500' :\n                          'bg-gray-300'\n                        }`}\n                        style={{ width: isCompleted ? '100%' : isCurrent ? '50%' : '0%' }}\n                      />\n                    </div>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        </motion.div>\n        \n        {/* Quick Actions */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"bg-white rounded-xl shadow-lg p-6 border border-gray-200\"\n        >\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Quick Actions</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <button className=\"flex items-center gap-3 px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors\">\n              <FileText size={20} />\n              <span>Create Script</span>\n            </button>\n            <button className=\"flex items-center gap-3 px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors\">\n              <Image size={20} />\n              <span>Add Illustration</span>\n            </button>\n            <button className=\"flex items-center gap-3 px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors\">\n              <Mic size={20} />\n              <span>Record Voice</span>\n            </button>\n            <button className=\"flex items-center gap-3 px-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors\">\n              <Video size={20} />\n              <span>Create Animation</span>\n            </button>\n          </div>\n        </motion.div>\n      </div>\n    )\n  }\n  \n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n        <span className=\"ml-4 text-gray-600\">Loading content productions...</span>\n      </div>\n    )\n  }\n  \n  return (\n    <div className=\"space-y-6\">\n      {/* View Toggle */}\n      <div className=\"flex gap-4 mb-6\">\n        <button\n          onClick={() => setActiveView('overview')}\n          className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n            activeView === 'overview'\n              ? 'bg-blue-600 text-white'\n              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n          }`}\n        >\n          Overview\n        </button>\n        <button\n          onClick={() => setActiveView('pipeline')}\n          className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n            activeView === 'pipeline'\n              ? 'bg-blue-600 text-white'\n              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n          }`}\n        >\n          Pipeline View\n        </button>\n      </div>\n      \n      {activeView === 'overview' && renderOverview()}\n      {activeView === 'pipeline' && renderPipeline()}\n    </div>\n  )\n}\n\nexport default ContentProductionDashboard
